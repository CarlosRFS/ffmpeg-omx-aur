From 534270e660fc4bcaba43e54c5a5781fcbd4eee43 Mon Sep 17 00:00:00 2001
From: Carlos Raimundo de Freitas Sotero <carlosrfs99@gmail.com>
Date: Sun, 1 Oct 2023 17:22:38 -0300
Subject: [PATCH 6/6] fix code for gop parameter work on omx hevc encoder on
 ffmpeg n6.0... this is based on starfive tech patches:
 https://github.com/starfive-tech/Debian/tree/20221225T084846Z/multimedia/patch/ffmpeg

---
 libavcodec/omx.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/libavcodec/omx.c b/libavcodec/omx.c
index 8a13cc6dbe..641707f08d 100644
--- a/libavcodec/omx.c
+++ b/libavcodec/omx.c
@@ -568,13 +568,12 @@ static av_cold int omx_component_init(AVCodecContext *avctx, const char *role)
         err = OMX_SetParameter(s->handle, OMX_IndexParamVideoAvc, &avc);
         CHECK(err);
     } else if (avctx->codec->id == AV_CODEC_ID_HEVC) 
-    	OMX_VIDEO_PARAM_AVCTYPE hevc = { 0 };
+    	OMX_VIDEO_PARAM_HEVCTYPE hevc = { 0 };
         INIT_STRUCT(hevc);
 	hevc.nPortIndex = s->out_port;
 	err = OMX_GetParameters(s->handle, OMX_IndexParamVideoHevc, &hevc);
 	CHECK(err);
-	hevc.nBFrames = 0;
-	hevc.nPFrames = avctx->gop_size;
+	hevc.nKeyFrameInterval = avctx->gop_size;
 	err = OMX_SetParameter(s->handle, OMX_IndexParamVideoHevc, &hevc);
 	CHECK(err);
     }
-- 
2.41.0

